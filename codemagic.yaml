workflows:
  yetanothernotes-debug-workflow:
    name: YetAnotherNotes Debug Workflow
    max_build_duration: 60
    instance_type: mac_mini
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'feature/*'
          include: true
          source: true
        - pattern: 'bugfix/*'
          include: true
          source: true
      cancel_previous_builds: false
    scripts:
      - name: Build debug Android app
        script: ./gradlew assembleDebug
      - name: Test debug Android app
        script: ./gradlew test
        test_report: app/build/test-results/**/*.xml
    artifacts:
      - app/build/outputs/**/**/*.apk
    publishing:
      email:
        recipients:
          - mk.allegro.acc@gmail.com
        notify:
          failure: true

  yetanothernotes-release-workflow:
    name: YetAnotherNotes Release Workflow
    max_build_duration: 60
    instance_type: mac_mini
    environment:
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmdiMDRZS01XWlZFTFZ4T3k0THowVlJEbUQzRFlSTnc4eGNaN2toNXJOUFJkeUhyNEVPT3ZRcHR2ejZlVXVjY3F0M1ZNMTdhUHE3eGl0MG83ZmFTaFBRcGRKWXQ1Z3JsaFRyN2FoUFhNZUMyLTA3dU9WNXhYR2FkNHJyaVlBV3FSMmUxZVJsNW5LVl9Ua1k0ZG9PSXVPMUZ1Rk9sOTBkZi02Z2wxdjV2bDVoVUd1QUF6VE5jaFNUOXBiNFRXeXJoWTE4UFVwSnVucEZtQUtEdkl5MThpVkVSRFRWd3VSbXZEVmVoLUhBb0J2UHJjNVJER0ltZ21KT2VIUm05T2s5UThfQ3RHdlM2dXY1MTNWbkZidjdncHdpZE44TnJvbDlucUJlTUtabExqbFd0Zy05cVhwUzJoY1dPT3o5bWQxZGVPYnFsR0djU1VRWEFSZVdNZ0JCNTZDMnZXT3FhcmRRN3JWSVRHZmk3NVdyQ0hZb3cyRVJOaldEWlJya0xhaXFnT0RPdWIzaWg4NjY4NFJlT0diYm1rWHJkTjh6a2k5T3pmcjdWMGgtcHFkVEU2MF90WlA2WkRWZl9URlBDTEJ6bDRnay00c2FISFI1YVFzaXZna2pVTmhIRldFNTQ5eHd5Q0VjRExSamtOeGJsdzNEcEFDbURJQmJSMFRUQ0FRcTBTc2lRUGs2bkNROVU3V0UyQ2tNREc5WTlFc1o1eG1fbjIzdlUtc3RfaDhyakVWaEoyb2k1YlVnVWZvdTlSWFhzU2FQQ0lWUUZrMFZLa1g2M0JlNVREZER6TzBTOE1xX3Jqd1Ayb2JtTmJZeVNibFF5VXdNN1I4X1dCUG4tQ0JVWW1sdExhbzk5ejMwc1hWNUNMM01DaXhIWXRFZUV0STYzLW5kdHU2VmNZYTFNRlh6ZG91U2xkeElUcnJwTmR3M1ZFRXoyRXQwZHo4LVBtdThicTJ3ZVUtOHNuTDFiT3Q5T0NMajVMVzNaZllIVWVUVG10bXdid0hHOERwcUVCZV9fQURKenBDZ0labk1SZ2NyUHJBZDZCTTBSVW1EQktfMEVIb3c3UFo3dFd6QVpZbWlvaThQS20tVVB5ZnEwNEQzMUE5QUtoRG43TEQ3ZXRzOTZHVWpxdlVVbExQb2FfMjM3bHpVWWhTWm1QNUhaTjhNRkF5MGg0RF9oS3l0d0NySUVKZnN0VlpEell4TmpsY3U4d1V4RFBKZ1BQZlBiT0tUU1d0THo2RldTc0V1V3M4WTlWQUVYNDVhdV9uQW04N0ZJYnNYbTFaQVI5emdlM0ZmdEtiVzJKZHYzdDJ0NnpnVmFKeld2RTA3ZnQ2djdid2Y2TXh5c1NkemJDREU5ckNrbi1mWGtZN2tBU0p2LWhxQkdMLW1MT3BCblBRa0ZOTjd4b3BneE1RdzBXS0RYclBwa3FWeXh6ODBRTG5kSUtwM1FYcE5OT0pjYnhRczBKYUloaE5oQXloTDEzdklUMm1jbGUtMnpYRDFOYXdUZmVoR1YzTlNGQ2xWSkNCM2NPN1ZHSUpMeHdlRUNlclhzZDJJUjMxXzJ2d2x1YkhQZ19TVDlINUdPamQyaGFubEozNXJPOFdobEp2LVl3eXVHZ3UxUnM4NURhZ1BsSlZwU1Itd1BMWDFEWlJvSld6YzJoeXVjMGg4VDhBYlpjVXhKM2JtQ3ZCamtjeXlIOVY3NjhfYU9laDFMNnpuWEoySWdid0psV3lyWGdOZDl1WlRmWHRjS1JHVEd2NU5zbnlHVWd1M1JOTWlYTU15M0F1bmtmRzR3U092STUzTUxKc1F5SFc3NjJTYXBkUmJPX1VXTjZvSnhvX294aE5wRnJDMVhsOFF2NlJ5aHNhSzdHVzBFVnIySFV1RDJfbm45U1NkUldQdFkybmE5SmtJYTU0bzRsUGcySXh4bTVsWERJNkh4dXpyb3FBcVBHQWhGU3lGSUlHb0NKaVR5Z3NFU3Z4WVNVMjBaZW9YemMwaE9maHE3VWtSb3dFMS0xY2ZtczVGbHRLNm1RWjVKZTR2bWRvZHRKeWZDWHJuY25nSkRBOGlJVUJ6VjA2bEl1LS1fcHlIejhDNHRhdWtuUWZMbS1UWnM5R0FTQW9sOWpWYmY0VnRyd1pzdDQzOGwwT0JhdEV6TTlSRlFVdkpJOXRvSEpRRXBvTjBtZ3Z0NGhIVzZ1c1hhUmt4cUlGajYyTEkyVGlGa1BZSXh0MURUOVZJUnNSSS1Qa01MUm5XQ2tYOVJqQTlhMTdLSXg2aC1yOXkxOEk5T3NQOWVjS1U1ZVNoVkZHWlVXemZyUkpDelNBZmFSOTg1Vko0bEQzUHJWX19TeG9QbDhzVlN2NUswWDFqMUhFYVhkOWNaZS1DSEVPdXFMNk0yNEZEaUgwcEFFOFdoWnJ1MERpMGlZbnVWbmNCWllPQnBCZE92dERNdmFpUnptcFFZcTVlNHduWkdISzkwaUdVNHB4SG9fXzJ4TFZMN1Z6MmJDZlRvMk1TTVZ2Y2VKTUFwamdfY3pfeWxHZEcxeWVKMGFRemxtWkUzODFyR1pnZTNNbzBkbUtNQVVDT0d2LVJZUWMzcDhQWDVqc2hLajVhNlQyNktHd29lOGhKMVVxZmVULV81aXZ4Yk9MbHZ2Z2dNMjhJaWJIX3QybERCYWRGRTJwVHFxWVBPT2VuLUhyQkozdDc3ZGthLVNOeWkySlhtNE44T0trU3JRUDNiUEFPYlI3WFNjWW5iTTdDYmRKbnFkWkdMOEN5T2R0TjFkOVp3a3Byb1R6ZTEtNl8zd0RMRi1QNlZnYXhIbDRKaGU3MFZOMDNwb1YwZ3BMajRPWEpBZDJQSGJnQ1EtZU5yeFYwQlBYaDdzbmxXaU9kczl5Yjh5bEpGaWluNjRYUGQ4aEo1amtuajBubjBnYUE1Mi1yVm54ZVNUMzh2Z2xULXRPZllrWThDVm5ucmlYaERoMXZJS0NvQnExZlkyZnlMZ3JKVGRMZ0lSN2NCTmN5Ti04YW8xRUNMRGQzV3lRX18zUnFYMDg3MzlVSmc4UWhYME5zOHlKSFgzZEVxRWpxSXRWQlZwVlZManAxR05mQUtRWHlkWjJlQnpYcWh2RThqUlZsWTdHWjRsaWhvTWRjR1hBN0xILWZKR1YxV0xSUmNrWW8zVEExdHN4ajBPNHRBWG1xWTRZNG1nSHJuM0FoRE5rS0ZsaWxTTHQwY29lT2RIdE5OeWxfc3RWaWtMM1MzM0VqR2VDQTJpaVBndFM0eWhJSUYxUG81bzJKYmRSLVJoTE1EclEwck9DWnhWVWk5a0pfbXp3RWw5Q1g2NUxTbUJYYmQyRkZTVl9CcmFGQjBBZ3cyNlBJWXdLNWx4elFRUmlGRnYwQ2dQamxrRlJSYXNWa2JDQkUzRnBGcFBodG9QNDRRdG1jbGVnRk5VSm01NGFKZ2Zod1g4dHpnZ19fZ1hvRXB3N0wzVkRMOFpzemtxdFBWUjBvSFhvTjhYanh1ODJ6THlRYVo4OVZqSmZTaGlaUnRJbnFSQkVyRkZXNVBkMGduZW9TMTlHTnJBVklBLXNGNHZHdV91YVJaLUtwWW5uaGRfemlnbXRWNm5teElVakVZNkcyeFVHVkZIcm4yWnRRVFR6TnN0WTFCbXFIOGUybTl3VFNQOHV6ZlBSSDBLbEl6THhrZWREZkdsQ3hONmQycm12MlRidjVSRWc5Qml2c3J3b0hlWlRMMTFjRl9XN1lDdGFxRVhHZ1ZEYUdsMnZON0xvUzJ2Z081S01HTXltbTFDT1B3cUJOSXI4ZzduUVNja01nMUFjU2lNNnlPRTlMRkxlXzVnbjJJQTdlOG9mZmdSaEJtUloxcnpOQV9WXzV2XzFFLUwwb2R6VlhvblM4bUpuMldFdDlyYV9kaDVrS045LW9oNEE3OEZhb3JVVnJtblNuYWMwT3Bjdmx2MmF5MUVFRjJ2RlIxUWp6TjdTdER4RV9SQjZ6QWk4THJIdDlSVmgtc3Y4SWFiT0tTRFlfUzlTSmI2ZHJwWFJ0YU1IeVZ4MW5naHNFOWpfLWZFc1g1eEcyTTI3dWowbDdtbmlaSlF6cnVvekk1VFFWYkNPT0hGaU5wZ3pLOXNXeXFPSzA4Y3Z0aFhQS0o0NlZLQ2I3YnVuaTRlNUplMkVUc2ZhUXZnMnZ0eFNwUVN0M0J4QnR6ZlJkeFFXSnYwMWtmZUJiNHVnM0tLSndhcHZBTmllRFJuNEJVQ3RGSmpKS0V2ZW01WWlDcVFhZ2dreEVyOXdHSlZRZHptOF8yVWZwVGVlcm9mczViR1Y2dFlYaUJVa3ZXdFYtay15c1FuSlFzMzdyMVpWRlZOWUY3aFQyQVNsTEZETGlnYzY5NnRYeVVpOS1KU3BFWk1yLTVfdTliS29uSDdRblRWWXZ5NjkwcmZsWW4tcFAzZklDcDI1cTN0bDA4Szk4dzhOMEcwMi1PeFBGbkhuV2JaZHVLS1hxZFZtSVdkeFJSWDlHSjdzSy00V181REtUSUtEb3NsbW5XZDZ3TjBiR29Gamd5by1seUd0cHZ0Q2gzTzVhN0hWalVlbEdMLS1FdmpNWXBPMWVxaF9yR1RNdktVWmlzU3dYaXZsU25fMjZQNzRUUUFSTjVSXzR0MHZlOUZUMTZERHEzcVZFUHZKM2g3ZWUyUGNVLWtGalgyZV9Mam5qNHFwX0FpeVg3NjNOVWQ2dnQwLWJCTV9BSkxoRG9Pa0xFeV9RM2R1WGJRU0g0MUEwaHo4OE80eW96Y1lLaXczSGhQZE4xejZxVVRJVGtabmNMYjctbmZ4NmZIaC1CVXU0NjNhblEtMDlYRXh2YlRpU0VweUt6WDRRZGR5XzVNX1ZHMDg5Rm5RZ1Fkei04dnVLU29fOVVYNEh1OC0xRGtickF0Y1drb1NUWEFnVTJIMjRxRjF4R1NZR1NPR1NENVJodFAxbVYxVC1iWkRQM3JCSlpMTFl6Y1hCc29MVHMtcHVsZDlFWk1WZzZjdXRpRHRNOXNhX3dFMy1ESHVNdVNqbFN3WTdfRVZmNEpxWE9icVQyS0duSkpJSXgydWx2bVFlbGJDRHlnbEp5bDZxVmplaFZjU0k2QVRnTmlXNDMzdTBoUHA1MzRmRnFQRDJ4a09qeHJYUnZON3Z2eUw0XzFMQzN6aFJuOE5vX0hHOEl0bFhFaU4zUU01eGl4amN3QjZXTzUyQUxZZ19jNDBMOUxaNldORUxCVkNJb0dzdXdzVUdYcG4yX0l5MVY5UUNNZUZKZ01DTUk4eG1JdHV1LVFxWXZDSklJbVFFZ1ZCLTdvU3BXTmxQemZCRjdkTXhYb0lOc2VOTHoyQTk2YkVPenBQUUhScFl6alZtSEpKRXpwclNseHJjU05ORzFsTW1lN29HeXBJTXdtemM4VVBOeWlkZXhmSlJlbjNMa3hfelZTSUxMRlREOFJISVF3d19nVVVHU1ltMlltT2RHLUZ4S2JPWUN6X2pveVdzTUJ5eTZtbnkwUFVBZkxOb3c9PQ==)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdiMDhudHhQd1FtYjhaZHFIN0NNeTFiQTdRMk5kdXdYcUxsaV9JUnRGdnNxTTlxbVV0N3h0YndaZjUyQTZ4Z1ZRM1RLUWdvQVNyZTdYNXAwUE9hSGFkSlBBX1dmcWhUNHh2cmp1REFWanJQSXA0QVk9)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmdiMDlaVGxqby1BMmhpMzRnSHNVZTVPNk91RXEzOGlnb3NmajhPUm9BUWFMNmppaF8tNHlvTDZKNUhQYURScE1SU3dRejdfSktKVE44STF1d0l6d0RuWnFXZWlXN1VWRFRvNG5oNzU1SmtKMXdfbWs9)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmdiMDl2QlYxNVE4NzBCdGgteTlQQlZHZlluYUZnbGQwZTFkWFVaSlFzdng0V09aMzFUTldJbjhHMU4xcjBiZG5ETXVGSWNMV21nOHRHdEU3LWJFRnpmTGpzbC05SkZqMWRNYUNSeThCdkdYcHE0bmFVVUJKRXdkWGpQbk9IUWxpdGF4NWU=)
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'release/*'
          include: true
          source: true
      cancel_previous_builds: false
    scripts:
      - name: Set up local properties
        script: echo "sdk.dir=$HOME/programs/android-sdk-macosx" > "$FCI_BUILD_DIR/local.properties"
      - name: Set up key.properties
        script: |
          echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_PASSWORD
          keyAlias=$FCI_KEY_ALIAS
          storeFile=$FCI_KEYSTORE_PATH
          EOF
      - name: Build Android app
        script: ./gradlew assembleRelease
      - name: Test Android app
        script: ./gradlew test
        test_report: app/build/test-results/**/*.xml
    artifacts:
      - app/build/outputs/**/**/*.apk
    publishing:
      email:
        recipients:
          - mk.allegro.acc@gmail.com
        notify:
          success: true
          failure: true
